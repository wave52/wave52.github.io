<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.png?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="WebGL 对于前端同学来说是一个非常值得学习的方向，没错，它不是一个必须要掌握的技能，但是非常值得学习，为什么呢？">
<meta property="og:type" content="article">
<meta property="og:title" content="WebGL入门">
<meta property="og:url" content="http://wuchengran.com/2019/04/01/webgl入门/index.html">
<meta property="og:site_name" content="wave52">
<meta property="og:description" content="WebGL 对于前端同学来说是一个非常值得学习的方向，没错，它不是一个必须要掌握的技能，但是非常值得学习，为什么呢？">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://wuchengran.com/images/webgl/图片1.png">
<meta property="og:image" content="http://wuchengran.com/images/webgl/图片2.jpg">
<meta property="og:image" content="http://wuchengran.com/images/webgl/图片3.jpg">
<meta property="og:image" content="http://wuchengran.com/images/webgl/图片4.png">
<meta property="og:updated_time" content="2020-11-23T16:13:48.181Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebGL入门">
<meta name="twitter:description" content="WebGL 对于前端同学来说是一个非常值得学习的方向，没错，它不是一个必须要掌握的技能，但是非常值得学习，为什么呢？">
<meta name="twitter:image" content="http://wuchengran.com/images/webgl/图片1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wuchengran.com/2019/04/01/webgl入门/"/>





  <title>WebGL入门 | wave52</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wave52</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wuchengran.com/2019/04/01/webgl入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="伍二娃">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wave52">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">WebGL入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-01T18:58:11+08:00">
                2019-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>WebGL 对于前端同学来说是一个非常值得学习的方向，没错，它不是一个必须要掌握的技能，但是非常值得学习，为什么呢？</p>
<a id="more"></a>
<p>可能大多数同学们首先想到的是 WebGL 可以做出牛 X 的效果。但是仅仅为了这点，我建议学习 Three.js 就够了，它是基于 WebGL 封装的三维图形库，无需了解底层的实现原理，稍微有点空间知识就能上手，用于生产时我也建议使用 Three.js。但是这就好像“我们学了 React 难道就不需要会 Dom 操作了吗”一样。了解 WebGL 不仅仅是为了做特效这么简单，我认为它值得学习有以下四点原因：</p>
<h3 id="1-学习了-WebGL-相当于学习了-OpenGL。"><a href="#1-学习了-WebGL-相当于学习了-OpenGL。" class="headerlink" title="1. 学习了 WebGL 相当于学习了 OpenGL。"></a>1. 学习了 WebGL 相当于学习了 OpenGL。</h3><p>许多同学应该知道，WebGL 是 OpenGL 的 JavaScript 实现。那么 OpenGL 是什么，OpenGL 是 Open Graphics Library 的简称，即“开放式图形库”，用来做 2D、3D 矢量图形的光栅化渲染。同样的图形库还有 DirectX（爱玩游戏的同学肯定知道）、Vulkan（近几年新出现的图形库，王者荣耀就出过 Vulkan 版）。即便是以上这些图形库在 API 上都是很相似的，WebGL 和 OpenGL 的 API 更是一模一样了，只是语言不同：</p>
<table>
<thead>
<tr>
<th>WebGL</th>
<th>OpenGL</th>
</tr>
</thead>
<tbody>
<tr>
<td>constant</td>
<td>gl. VERTEX_SHADER</td>
<td>GL_VERTEX_SHADER</td>
</tr>
<tr>
<td>function</td>
<td>gl.drawElements</td>
<td>drawElements</td>
</tr>
</tbody>
</table>
<h3 id="2-了解-GPU"><a href="#2-了解-GPU" class="headerlink" title="2. 了解 GPU"></a>2. 了解 GPU</h3><p>“图形库”说白了它就是操作 GPU 的 API，我们平时的写代码都算是 CPU 编程，用了 OpenGL 或者 WebGL 后我们就可以做 GPU 编程。在学习 WebGL 的过程中，我们不仅需要使用 JavaScript 调用 WebGL 提供的 API，我们还将学习一门新的语言 GLSL（Graphics Library Shader Language），也就是着色器语言。为什么要使用两种语言？因为就像刚刚说的，在 WebGL 程序中，既有在 CPU 执行的部分，也有在 GPU 执行的部分，JavaScript 调用 WebGL 的部分属于 CPU 编程，而 GLSL 可以直接通过 WebGL 传给 GPU 执行，即 GPU 编程，这其中的一些细节后文会讲到。</p>
<h3 id="3-入门图形学"><a href="#3-入门图形学" class="headerlink" title="3. 入门图形学"></a>3. 入门图形学</h3><p>使用 WebGL 不同于使用 three.js，后者只要有一些空间想象能力就能使用，但是前者却需要你掌握一些基本的图形学知识：比如渲染管线、着色器、纹理、光照等。了解了图形学以后，你对游戏引擎、电影特效也会有更深的理解。</p>
<h3 id="4-大厂、大佬布道"><a href="#4-大厂、大佬布道" class="headerlink" title="4. 大厂、大佬布道"></a>4. 大厂、大佬布道</h3><p>百度 ECharts 3D、阿里 G3D、蚂蚁金服 AntV 里都能看到 WebGL 的身影；winter 老师也在 08 年 GMTC 大会上对图形学、WebGL 做过分享。</p>
<p>既然学习它有这么多好处，那就让我们开始吧，但在正式使用 webgl 之前让我先学习些基础知识。</p>
<h2 id="1-图形学相关知识"><a href="#1-图形学相关知识" class="headerlink" title="1 图形学相关知识"></a>1 图形学相关知识</h2><h3 id="1-1-渲染管线"><a href="#1-1-渲染管线" class="headerlink" title="1.1 渲染管线"></a>1.1 渲染管线</h3><p>我们需要了解的第一个知识点叫渲染管线。什么叫管线？其英文叫 pipeline，我们知道他有流水线的意思，其实渲染管线就是渲染的流水线，我们可以理解成渲染的流程。而渲染又是啥？就是要将我们定义的三维模型数据变成二维图像，最终呈现在屏幕上。渲染的流程具体说来有三个阶段：<br><img src="/images/webgl/图片1.png" alt="图1"></p>
<ul>
<li>应用程序阶段（Application Stage）</li>
<li>几何阶段（Geomguanetry Stage）</li>
<li>光栅化阶段（Rasterizer Stage）</li>
</ul>
<p>其中应用程序阶段就是我们开发者控制的阶段，即我们写代码的阶段，我们可以定义模型、相机、光照、纹理、动画等。几何阶段也有开发者可控制（可编程）的部分，但是几何阶段需要硬件支持，也就是 GPU 支持，可以理解为：应用程序阶段还是 CPU 编程，几何阶段是 GPU 编程。那中间一定有个衔接点，一会儿会讲到。</p>
<p>再说到几何阶段和光栅化阶段，这两个阶段需要硬件支持也就是 GPU，所以这两个阶段也被称为 GPU 渲染管线。这两个阶段我们先看下面两张图：<br><img src="/images/webgl/图片2.jpg" alt="图2"><br>其中：</p>
<ul>
<li>绿色的阶段都是完全可编程的（GLSL）。</li>
<li>黄色的阶段可配置，但不可编程（使用 WebGL API 提供的常量）。</li>
<li>蓝色的阶段完全固定。</li>
</ul>
<p><img src="/images/webgl/图片3.jpg" alt="图3"></p>
<p>首先我们需要知道，我们使用代码定义的模型大概是什么样的，其实不管再复杂的模型都是由一个个小的三角形构成的，这样小的三角形叫做图元，渲染一个复杂模型实则就是渲染许多个三维空间中三角形。那么我们就以渲染一个三角形来看上面的过程。</p>
<h4 id="1）顶点着色器"><a href="#1）顶点着色器" class="headerlink" title="1）顶点着色器"></a>1）顶点着色器</h4><p>三角形有三个顶点，这三个顶点包含着一些信息，最重要的就是顶点位置，三维空间的 3 个顶点一定能确定唯一的三角形（这里严谨点会在一条直线上，那也是能确定唯一线段的），但 4 个顶点就不一定能确定唯一图元了，这也解释了为什么用三角形做图元，所以顶点着色器，就是接收顶点数据，并渲染。</p>
<h4 id="2）图元着色器"><a href="#2）图元着色器" class="headerlink" title="2）图元着色器"></a>2）图元着色器</h4><p>我们刚才说了，三角形就是图元，其实这样说不准确，在 OpenGL 和 DirectX 中，我们可以事先用多个三角形拼接成一个自定义的最小图元，这样可以减少图元遍历次数，当然这不是所有模型都适用，你需要自己事先找寻规律设置好图元，所以图元着色器并不是个必要的步骤，而且更重要的是 webgl 中还不支持图元着色器。</p>
<h4 id="3）裁剪"><a href="#3）裁剪" class="headerlink" title="3）裁剪"></a>3）裁剪</h4><p>我们最终的渲染结果会呈现在 canvas 画布上，始终是要有个大小的，那么模型超出画布的部分就会被裁减，减少不必要的渲染。</p>
<h4 id="4）屏幕映射"><a href="#4）屏幕映射" class="headerlink" title="4）屏幕映射"></a>4）屏幕映射</h4><p>即三维空间映射到屏幕的过程，后面还会提到。</p>
<p>以上都是几何阶段，你会发现顶点位置在这个阶段是要素，顶点位置决定了顶点着色器的输入输出，顶点位置决定了一个模型会不会被裁减，顶点位置决定了映射到屏幕的样子。接下来就是光栅化阶段，光栅化其实就是像素化的意思，因为最终投影的屏幕时像素点构成的，所以要将连续的矢量图转化成离散的位图，图 2 其实看得很明白。</p>
<h4 id="5）三角形设定和遍历"><a href="#5）三角形设定和遍历" class="headerlink" title="5）三角形设定和遍历"></a>5）三角形设定和遍历</h4><p>这里的三角形指的就是上面说的图元，这里需要遍历，为了接下来的像素着色。</p>
<h4 id="6）像素着色器"><a href="#6）像素着色器" class="headerlink" title="6）像素着色器"></a>6）像素着色器</h4><p>我们之前只保存了，顶点位置信息，其实到了这步我们还需要顶点颜色信息才能将整个三角形带颜色地渲染出来，为什么只需要顶点颜色就行了，因为这里计算机做了一个插值操作，插值其实是个计算机很常见的操作，比如我们在做动画时有个词叫补间动画，我们只需要定义关键帧，定义动画类型，中间流畅的动画过程自动就生成了，其实就是计算机帮你做了。这里我们定义了顶点颜色，整个三角形的颜色就自动生成了，那如果你说这个插值不是你想要的结果？不好意思，你应该去定义个小一点的图元去做更精细化的控制。</p>
<h4 id="7）合并阶段"><a href="#7）合并阶段" class="headerlink" title="7）合并阶段"></a>7）合并阶段</h4><p>就是把所有模型的渲染合并，因为这其中可能有半透明的模型，所以这一部分也是有一定渲染工作要做</p>
<p>以上就是渲染管线了，即渲染的流程了，这其中不清楚的部分其实就是模型是怎么投影到屏幕的，三维是怎么转化成二维的</p>
<h3 id="1-2-模型、视图、投影（MVP）"><a href="#1-2-模型、视图、投影（MVP）" class="headerlink" title="1.2 模型、视图、投影（MVP）"></a>1.2 模型、视图、投影（MVP）</h3><p>一图胜千言<br><img src="/images/webgl/图片4.png" alt="图4"><br>在之前分享过程中，我还可以比划比划，这里大家只能看上图自行理解。首先概念先清楚：</p>
<ul>
<li>模型，即我们定义的三维空间中的物体</li>
<li>模型变换，即该物体自己的变换，比如旋转、移动、缩放</li>
<li>视图，即摄像机决定的所看到的空间</li>
<li>视图变换，即摄像机的变化导致的所看到的空间变化</li>
<li>投影，这个简单，其实就分两种：正交投影和透视投影</li>
<li>投影变化，这个也简单，只能在这两种投影间变换，一般就不变</li>
</ul>
<p>但是在代码层面是怎么做的呢？这里需要复习下线性代数知识，理解下矩阵的空间意义，其实三维空间里变换可以视为“乘一个矩阵”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 minMatrix 各种矩阵的生成和初始化</span></span><br><span class="line"><span class="keyword">var</span> mMatrix = m.identity(m.create()); <span class="comment">// 模型变换矩阵</span></span><br><span class="line"><span class="keyword">var</span> vMatrix = m.identity(m.create()); <span class="comment">// 视图变换矩阵</span></span><br><span class="line"><span class="keyword">var</span> pMatrix = m.identity(m.create()); <span class="comment">// 投影变换矩阵</span></span><br><span class="line"><span class="keyword">var</span> mvpMatrix = m.identity(m.create()); <span class="comment">// 最终的坐标变换矩阵</span></span><br><span class="line"></span><br><span class="line">m.lookAt([<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], vMatrix); <span class="comment">// 视图变换矩阵初始化</span></span><br><span class="line">m.perspective(<span class="number">45</span>, c.width / c.height, <span class="number">0.1</span>, <span class="number">100</span>, pMatrix); <span class="comment">// 投影变换矩阵初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 各个矩阵相乘的顺序使用示例</span></span><br><span class="line">m.multiply(pMatrix, vMatrix, tmpMatrix); <span class="comment">// p和v相乘</span></span><br><span class="line">m.multiply(mvpMatrix, mMatrix, mvpMatrix); <span class="comment">// 然后和m相乘</span></span><br></pre></td></tr></table></figure>
<h2 id="2-WebGL"><a href="#2-WebGL" class="headerlink" title="2 WebGL"></a>2 WebGL</h2><p>前面我们了解了图形学的一些基础知识，下面我们正式开始讲 webgl，其实编写 webgl 程序就是我们之前说的应用程序阶段，就是我们使用 javascript 调 webgl API 的过程。这个过程大致分为下面几步:</p>
<ul>
<li>从 HTML 中获取 canvas 对象</li>
<li>从 canvas 中获取 WebGL 的 context</li>
<li>编译着色器</li>
<li>准备模型数据</li>
<li>顶点缓存对象（VBO）生成和通知</li>
<li>索引缓存对象（IBO）生成和通知</li>
<li>生成 mvp 变换矩阵</li>
<li>发出绘图命令</li>
<li>更新 canvas 并渲染</li>
</ul>
<p>这其中难点：</p>
<ul>
<li>着色器：GLSL</li>
<li>MVP 矩阵：线性代数、第三方库</li>
<li>VBO、IBO：数据从内存存到显存以供 GPU 使用</li>
</ul>
<h3 id="2-1-着色器"><a href="#2-1-着色器" class="headerlink" title="2.1 着色器"></a>2.1 着色器</h3><p>那我们来看下第一个难点–着色器（shader）,着色器的作用之前已经讲过了，我们来看下代码长什么样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"vs"</span> <span class="attr">type</span>=<span class="string">"x-shader/x-vertex"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  attribute vec3 position;</span></span><br><span class="line"><span class="undefined">  attribute vec4 color;</span></span><br><span class="line"><span class="undefined">  uniform   mat4 mvpMatrix;</span></span><br><span class="line"><span class="undefined">  varying   vec4 vColor;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> main(<span class="keyword">void</span>)&#123;</span></span><br><span class="line"><span class="undefined">  	vColor = color;</span></span><br><span class="line"><span class="undefined">  	gl_Position = mvpMatrix * vec4(position, 1.0);</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"fs"</span> <span class="attr">type</span>=<span class="string">"x-shader/x-fragment"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  precision mediump float;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  varying vec4 vColor;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">void</span> main(<span class="keyword">void</span>)&#123;</span></span><br><span class="line"><span class="undefined">  	gl_FragColor = vColor;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>GLSL，类 C 语言</li>
<li>顶点着色器、片段着色器</li>
<li>Attribute: 每个顶点不同的属性</li>
<li>Uniform: 顶点相同的属性</li>
<li>Varying: 顶点着色器与片段着色器相互传递的属性</li>
<li>Precision: 精度（mediump：精确度中）</li>
<li>对三维图形变换需要对它作用四维矩阵（<a href="https://zhuanlan.zhihu.com/p/20514920）" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/20514920）</a></li>
<li>齐次坐标变换</li>
</ul>
<h3 id="2-2-变换矩阵"><a href="#2-2-变换矩阵" class="headerlink" title="2.2 变换矩阵"></a>2.2 变换矩阵</h3><p>这个也是前面提到过的了，主要看下下面两个方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m.lookAt([<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], vMatrix); <span class="comment">// 视图变换矩阵初始化</span></span><br><span class="line">m.perspective(<span class="number">45</span>, c.width / c.height, <span class="number">0.1</span>, <span class="number">100</span>, pMatrix); <span class="comment">// 投影变换矩阵初始化</span></span><br></pre></td></tr></table></figure>
<p><code>lookAt</code>是生成视图矩阵的方法，有 4 个参数，第一个参数是相机位置，这里在第二个参数是看向哪个点，第三个参数是相机摆向，这个怎么理解呢，比如把我们人看成相机，我们正常站着，我们的摆向就是头朝天花板；我们躺在，我们摆向就是头朝墙；我们倒立着，我们摆向就是头朝地，第四个参数用来保存计算结果的矩阵。</p>
<p><code>perspective</code>是生成透视投影矩阵的方法，我们前面知道投影分为透视投影和正交投影，perspective 的意思就是透视，有 5 个参数，第一个参数是视角，第二个参数是屏幕的宽高比例，第三个参数 是近截面的位置，第四个参数远界面位置，最后一个参数 用来保存计算结果的矩阵。</p>
<h3 id="2-3-缓存对象"><a href="#2-3-缓存对象" class="headerlink" title="2.3 缓存对象"></a>2.3 缓存对象</h3><p>我们之前提到过，我们用 javascript 调用 webgl API 时，属于 CPU 编程，中间定义的变量存在内存中，而最终需要 GPU 渲染，我们需要将变量存到显存中，缓存对象可以理解为做这件事的东西。</p>
<ul>
<li>顶点属性、VBO、顶点属性元素数一一对应</li>
<li>顶点可以有许多属性，如位置、颜色、法线等（其中位置是必须的，其他可选）</li>
<li>顶点的每个属性都要定义属性的数据，由于是一维数组所以需要用顶点属性元素数标识，如：顶点位置属性元素数是 3（xyz）顶点、顶点颜色属性元素数是 4(rgba)</li>
<li>顶点的每个属性都要定义 VBO，CPU 编程与 GPU 编程的衔接</li>
</ul>
<h3 id="2-4-实践"><a href="#2-4-实践" class="headerlink" title="2.4 实践"></a>2.4 实践</h3><p>一个简单 demo，转动的彩色三角形。</p>
<ul>
<li>index.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./script/minMatrix.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./script/script.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"vs"</span> <span class="attr">type</span>=<span class="string">"x-shader/x-vertex"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      attribute vec3 position;</span></span><br><span class="line"><span class="undefined">      attribute vec4 color;</span></span><br><span class="line"><span class="undefined">      uniform   mat4 mvpMatrix;</span></span><br><span class="line"><span class="undefined">      varying   vec4 vColor;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">void</span> main(<span class="keyword">void</span>)&#123;</span></span><br><span class="line"><span class="undefined">      	vColor = color;</span></span><br><span class="line"><span class="undefined">      	gl_Position = mvpMatrix * vec4(position, 1.0);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"fs"</span> <span class="attr">type</span>=<span class="string">"x-shader/x-fragment"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      precision mediump float;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">      varying vec4 vColor;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">void</span> main(<span class="keyword">void</span>)&#123;</span></span><br><span class="line"><span class="undefined">      	gl_FragColor = vColor;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>script/script.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 获取canvas元素</span></span><br><span class="line">  <span class="keyword">var</span> c = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</span><br><span class="line">  c.width = <span class="number">500</span>;</span><br><span class="line">  c.height = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取webgl上下文</span></span><br><span class="line">  <span class="keyword">var</span> gl = c.getContext(<span class="string">"webgl"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成顶点和片段着色器</span></span><br><span class="line">  <span class="keyword">var</span> v_shader = create_shader(<span class="string">"vs"</span>);</span><br><span class="line">  <span class="keyword">var</span> f_shader = create_shader(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成和链接程序对象</span></span><br><span class="line">  <span class="keyword">var</span> prg = create_program(v_shader, f_shader);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// attributeLocation 的获取，并存到到数组</span></span><br><span class="line">  <span class="keyword">var</span> attLocation = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">2</span>);</span><br><span class="line">  attLocation[<span class="number">0</span>] = gl.getAttribLocation(prg, <span class="string">"position"</span>);</span><br><span class="line">  attLocation[<span class="number">1</span>] = gl.getAttribLocation(prg, <span class="string">"color"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将 attribute 的元素数存储到数组中</span></span><br><span class="line">  <span class="keyword">var</span> attStride = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存储顶点属性的数组</span></span><br><span class="line">  <span class="keyword">var</span> position = [<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">-1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>];</span><br><span class="line">  <span class="keyword">var</span> color = [<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// VBO的生成</span></span><br><span class="line">  <span class="keyword">var</span> pos_vbo = create_vbo(position);</span><br><span class="line">  <span class="keyword">var</span> col_vbo = create_vbo(color);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册VBO</span></span><br><span class="line">  set_attribute([pos_vbo, col_vbo], attLocation, attStride);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// uniformLocation 的获取</span></span><br><span class="line">  <span class="keyword">var</span> uniLocation = gl.getUniformLocation(prg, <span class="string">"mvpMatrix"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 minMatrix 的矩阵相关处理</span></span><br><span class="line">  <span class="comment">// 生成 matIV 实例对象</span></span><br><span class="line">  <span class="keyword">var</span> m = <span class="keyword">new</span> matIV();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成和初始化各种矩阵</span></span><br><span class="line">  <span class="keyword">var</span> mMatrix = m.identity(m.create()); <span class="comment">// 模型变化矩阵</span></span><br><span class="line">  <span class="keyword">var</span> vMatrix = m.identity(m.create()); <span class="comment">// 视图变化矩阵</span></span><br><span class="line">  <span class="keyword">var</span> pMatrix = m.identity(m.create()); <span class="comment">// 投影矩阵</span></span><br><span class="line">  <span class="keyword">var</span> tmpMatrix = m.identity(m.create()); <span class="comment">// vp temp矩阵</span></span><br><span class="line">  <span class="keyword">var</span> mvpMatrix = m.identity(m.create()); <span class="comment">// mvp 矩阵</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 视图×投影变换矩阵</span></span><br><span class="line">  m.lookAt([<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], vMatrix);</span><br><span class="line">  m.perspective(<span class="number">45</span>, c.width / c.height, <span class="number">0.1</span>, <span class="number">100</span>, pMatrix);</span><br><span class="line">  m.multiply(pMatrix, vMatrix, tmpMatrix);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 计数器声明</span></span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染循环</span></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// canvas 初始化</span></span><br><span class="line">    gl.clearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    gl.clearDepth(<span class="number">1.0</span>);</span><br><span class="line">    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 递增计数器</span></span><br><span class="line">    count++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据计数器计算弧度</span></span><br><span class="line">    <span class="keyword">var</span> rad = ((count % <span class="number">360</span>) * <span class="built_in">Math</span>.PI) / <span class="number">180</span>;</span><br><span class="line">    <span class="comment">// 1° = π/180°，1rad= 180°/π。</span></span><br><span class="line">    <span class="comment">// 一周是 360 度，也是 2π 弧度，即 360°=2π.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 围绕Y轴旋转</span></span><br><span class="line">    m.identity(mMatrix);</span><br><span class="line">    m.translate(mMatrix, [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>], mMatrix);</span><br><span class="line">    m.rotate(mMatrix, rad, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>], mMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 完成并渲染模型，坐标变换矩阵</span></span><br><span class="line">    m.multiply(tmpMatrix, mMatrix, mvpMatrix);</span><br><span class="line">    gl.uniformMatrix4fv(uniLocation, <span class="literal">false</span>, mvpMatrix);</span><br><span class="line">    gl.drawArrays(gl.TRIANGLES, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重绘上下文</span></span><br><span class="line">    gl.flush();</span><br><span class="line">  &#125;, <span class="number">1000</span> / <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于生成着色器的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">create_shader</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 存储着色器的变量</span></span><br><span class="line">    <span class="keyword">var</span> shader;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从HTML获取对script标记的引用</span></span><br><span class="line">    <span class="keyword">var</span> scriptElement = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// script标签不存在时删除</span></span><br><span class="line">    <span class="keyword">if</span> (!scriptElement) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查script标记的type属性</span></span><br><span class="line">    <span class="keyword">switch</span> (scriptElement.type) &#123;</span><br><span class="line">      <span class="comment">// 顶点着色器</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"x-shader/x-vertex"</span>:</span><br><span class="line">        shader = gl.createShader(gl.VERTEX_SHADER);</span><br><span class="line">        <span class="built_in">console</span>.log(gl.VERTEX_SHADER);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 片段着色器</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">"x-shader/x-fragment"</span>:</span><br><span class="line">        shader = gl.createShader(gl.FRAGMENT_SHADER);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将代码指定给生成的着色器</span></span><br><span class="line">    gl.shaderSource(shader, scriptElement.text);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编译着色器</span></span><br><span class="line">    gl.compileShader(shader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查着色器是否正确编译</span></span><br><span class="line">    <span class="keyword">if</span> (gl.getShaderParameter(shader, gl.COMPILE_STATUS)) &#123;</span><br><span class="line">      <span class="comment">// 如果成功，则返回着色器并退出</span></span><br><span class="line">      <span class="keyword">return</span> shader;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 失败时发出错误日志警报</span></span><br><span class="line">      alert(gl.getShaderInfoLog(shader));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成程序对象并链接着色器的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">create_program</span>(<span class="params">vs, fs</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 生成程序对象</span></span><br><span class="line">    <span class="keyword">var</span> program = gl.createProgram();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将着色器指定给程序对象</span></span><br><span class="line">    gl.attachShader(program, vs);</span><br><span class="line">    gl.attachShader(program, fs);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 链接着色器</span></span><br><span class="line">    gl.linkProgram(program);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查着色器链接是否正确</span></span><br><span class="line">    <span class="keyword">if</span> (gl.getProgramParameter(program, gl.LINK_STATUS)) &#123;</span><br><span class="line">      <span class="comment">// 在成功后启用程序对象</span></span><br><span class="line">      gl.useProgram(program);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回程序对象并退出</span></span><br><span class="line">      <span class="keyword">return</span> program;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 失败时发出错误日志警报</span></span><br><span class="line">      alert(gl.getProgramInfoLog(program));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成 VBO 的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">create_vbo</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 生成缓冲区对象</span></span><br><span class="line">    <span class="keyword">var</span> vbo = gl.createBuffer();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定缓冲区</span></span><br><span class="line">    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数据放入缓冲区</span></span><br><span class="line">    gl.bufferData(gl.ARRAY_BUFFER, <span class="keyword">new</span> <span class="built_in">Float32Array</span>(data), gl.STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 禁用缓冲区绑定</span></span><br><span class="line">    gl.bindBuffer(gl.ARRAY_BUFFER, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回生成的 VBO</span></span><br><span class="line">    <span class="keyword">return</span> vbo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于绑定和注册 VBO 的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">set_attribute</span>(<span class="params">vbo, attL, attS</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理作为参数接收的数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> vbo) &#123;</span><br><span class="line">      <span class="comment">// 绑定缓冲区</span></span><br><span class="line">      gl.bindBuffer(gl.ARRAY_BUFFER, vbo[i]);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 启用 attributeLocation</span></span><br><span class="line">      gl.enableVertexAttribArray(attL[i]);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 通知 attributeLocation 并注册</span></span><br><span class="line">      gl.vertexAttribPointer(attL[i], attS[i], gl.FLOAT, <span class="literal">false</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>script/minMatrix.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matIV</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="number">16</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.identity = <span class="function"><span class="keyword">function</span>(<span class="params">dest</span>) </span>&#123;</span><br><span class="line">    dest[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dest[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">    dest[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">9</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">10</span>] = <span class="number">1</span>;</span><br><span class="line">    dest[<span class="number">11</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">13</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">14</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">15</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.multiply = <span class="function"><span class="keyword">function</span>(<span class="params">mat1, mat2, dest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = mat1[<span class="number">0</span>],</span><br><span class="line">      b = mat1[<span class="number">1</span>],</span><br><span class="line">      c = mat1[<span class="number">2</span>],</span><br><span class="line">      d = mat1[<span class="number">3</span>],</span><br><span class="line">      e = mat1[<span class="number">4</span>],</span><br><span class="line">      f = mat1[<span class="number">5</span>],</span><br><span class="line">      g = mat1[<span class="number">6</span>],</span><br><span class="line">      h = mat1[<span class="number">7</span>],</span><br><span class="line">      i = mat1[<span class="number">8</span>],</span><br><span class="line">      j = mat1[<span class="number">9</span>],</span><br><span class="line">      k = mat1[<span class="number">10</span>],</span><br><span class="line">      l = mat1[<span class="number">11</span>],</span><br><span class="line">      m = mat1[<span class="number">12</span>],</span><br><span class="line">      n = mat1[<span class="number">13</span>],</span><br><span class="line">      o = mat1[<span class="number">14</span>],</span><br><span class="line">      p = mat1[<span class="number">15</span>],</span><br><span class="line">      A = mat2[<span class="number">0</span>],</span><br><span class="line">      B = mat2[<span class="number">1</span>],</span><br><span class="line">      C = mat2[<span class="number">2</span>],</span><br><span class="line">      D = mat2[<span class="number">3</span>],</span><br><span class="line">      E = mat2[<span class="number">4</span>],</span><br><span class="line">      F = mat2[<span class="number">5</span>],</span><br><span class="line">      G = mat2[<span class="number">6</span>],</span><br><span class="line">      H = mat2[<span class="number">7</span>],</span><br><span class="line">      I = mat2[<span class="number">8</span>],</span><br><span class="line">      J = mat2[<span class="number">9</span>],</span><br><span class="line">      K = mat2[<span class="number">10</span>],</span><br><span class="line">      L = mat2[<span class="number">11</span>],</span><br><span class="line">      M = mat2[<span class="number">12</span>],</span><br><span class="line">      N = mat2[<span class="number">13</span>],</span><br><span class="line">      O = mat2[<span class="number">14</span>],</span><br><span class="line">      P = mat2[<span class="number">15</span>];</span><br><span class="line">    dest[<span class="number">0</span>] = A * a + B * e + C * i + D * m;</span><br><span class="line">    dest[<span class="number">1</span>] = A * b + B * f + C * j + D * n;</span><br><span class="line">    dest[<span class="number">2</span>] = A * c + B * g + C * k + D * o;</span><br><span class="line">    dest[<span class="number">3</span>] = A * d + B * h + C * l + D * p;</span><br><span class="line">    dest[<span class="number">4</span>] = E * a + F * e + G * i + H * m;</span><br><span class="line">    dest[<span class="number">5</span>] = E * b + F * f + G * j + H * n;</span><br><span class="line">    dest[<span class="number">6</span>] = E * c + F * g + G * k + H * o;</span><br><span class="line">    dest[<span class="number">7</span>] = E * d + F * h + G * l + H * p;</span><br><span class="line">    dest[<span class="number">8</span>] = I * a + J * e + K * i + L * m;</span><br><span class="line">    dest[<span class="number">9</span>] = I * b + J * f + K * j + L * n;</span><br><span class="line">    dest[<span class="number">10</span>] = I * c + J * g + K * k + L * o;</span><br><span class="line">    dest[<span class="number">11</span>] = I * d + J * h + K * l + L * p;</span><br><span class="line">    dest[<span class="number">12</span>] = M * a + N * e + O * i + P * m;</span><br><span class="line">    dest[<span class="number">13</span>] = M * b + N * f + O * j + P * n;</span><br><span class="line">    dest[<span class="number">14</span>] = M * c + N * g + O * k + P * o;</span><br><span class="line">    dest[<span class="number">15</span>] = M * d + N * h + O * l + P * p;</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.scale = <span class="function"><span class="keyword">function</span>(<span class="params">mat, vec, dest</span>) </span>&#123;</span><br><span class="line">    dest[<span class="number">0</span>] = mat[<span class="number">0</span>] * vec[<span class="number">0</span>];</span><br><span class="line">    dest[<span class="number">1</span>] = mat[<span class="number">1</span>] * vec[<span class="number">0</span>];</span><br><span class="line">    dest[<span class="number">2</span>] = mat[<span class="number">2</span>] * vec[<span class="number">0</span>];</span><br><span class="line">    dest[<span class="number">3</span>] = mat[<span class="number">3</span>] * vec[<span class="number">0</span>];</span><br><span class="line">    dest[<span class="number">4</span>] = mat[<span class="number">4</span>] * vec[<span class="number">1</span>];</span><br><span class="line">    dest[<span class="number">5</span>] = mat[<span class="number">5</span>] * vec[<span class="number">1</span>];</span><br><span class="line">    dest[<span class="number">6</span>] = mat[<span class="number">6</span>] * vec[<span class="number">1</span>];</span><br><span class="line">    dest[<span class="number">7</span>] = mat[<span class="number">7</span>] * vec[<span class="number">1</span>];</span><br><span class="line">    dest[<span class="number">8</span>] = mat[<span class="number">8</span>] * vec[<span class="number">2</span>];</span><br><span class="line">    dest[<span class="number">9</span>] = mat[<span class="number">9</span>] * vec[<span class="number">2</span>];</span><br><span class="line">    dest[<span class="number">10</span>] = mat[<span class="number">10</span>] * vec[<span class="number">2</span>];</span><br><span class="line">    dest[<span class="number">11</span>] = mat[<span class="number">11</span>] * vec[<span class="number">2</span>];</span><br><span class="line">    dest[<span class="number">12</span>] = mat[<span class="number">12</span>];</span><br><span class="line">    dest[<span class="number">13</span>] = mat[<span class="number">13</span>];</span><br><span class="line">    dest[<span class="number">14</span>] = mat[<span class="number">14</span>];</span><br><span class="line">    dest[<span class="number">15</span>] = mat[<span class="number">15</span>];</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.translate = <span class="function"><span class="keyword">function</span>(<span class="params">mat, vec, dest</span>) </span>&#123;</span><br><span class="line">    dest[<span class="number">0</span>] = mat[<span class="number">0</span>];</span><br><span class="line">    dest[<span class="number">1</span>] = mat[<span class="number">1</span>];</span><br><span class="line">    dest[<span class="number">2</span>] = mat[<span class="number">2</span>];</span><br><span class="line">    dest[<span class="number">3</span>] = mat[<span class="number">3</span>];</span><br><span class="line">    dest[<span class="number">4</span>] = mat[<span class="number">4</span>];</span><br><span class="line">    dest[<span class="number">5</span>] = mat[<span class="number">5</span>];</span><br><span class="line">    dest[<span class="number">6</span>] = mat[<span class="number">6</span>];</span><br><span class="line">    dest[<span class="number">7</span>] = mat[<span class="number">7</span>];</span><br><span class="line">    dest[<span class="number">8</span>] = mat[<span class="number">8</span>];</span><br><span class="line">    dest[<span class="number">9</span>] = mat[<span class="number">9</span>];</span><br><span class="line">    dest[<span class="number">10</span>] = mat[<span class="number">10</span>];</span><br><span class="line">    dest[<span class="number">11</span>] = mat[<span class="number">11</span>];</span><br><span class="line">    dest[<span class="number">12</span>] = mat[<span class="number">0</span>] * vec[<span class="number">0</span>] + mat[<span class="number">4</span>] * vec[<span class="number">1</span>] + mat[<span class="number">8</span>] * vec[<span class="number">2</span>] + mat[<span class="number">12</span>];</span><br><span class="line">    dest[<span class="number">13</span>] = mat[<span class="number">1</span>] * vec[<span class="number">0</span>] + mat[<span class="number">5</span>] * vec[<span class="number">1</span>] + mat[<span class="number">9</span>] * vec[<span class="number">2</span>] + mat[<span class="number">13</span>];</span><br><span class="line">    dest[<span class="number">14</span>] = mat[<span class="number">2</span>] * vec[<span class="number">0</span>] + mat[<span class="number">6</span>] * vec[<span class="number">1</span>] + mat[<span class="number">10</span>] * vec[<span class="number">2</span>] + mat[<span class="number">14</span>];</span><br><span class="line">    dest[<span class="number">15</span>] = mat[<span class="number">3</span>] * vec[<span class="number">0</span>] + mat[<span class="number">7</span>] * vec[<span class="number">1</span>] + mat[<span class="number">11</span>] * vec[<span class="number">2</span>] + mat[<span class="number">15</span>];</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.rotate = <span class="function"><span class="keyword">function</span>(<span class="params">mat, angle, axis, dest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sq = <span class="built_in">Math</span>.sqrt(</span><br><span class="line">      axis[<span class="number">0</span>] * axis[<span class="number">0</span>] + axis[<span class="number">1</span>] * axis[<span class="number">1</span>] + axis[<span class="number">2</span>] * axis[<span class="number">2</span>]</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (!sq) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> a = axis[<span class="number">0</span>],</span><br><span class="line">      b = axis[<span class="number">1</span>],</span><br><span class="line">      c = axis[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span> (sq != <span class="number">1</span>) &#123;</span><br><span class="line">      sq = <span class="number">1</span> / sq;</span><br><span class="line">      a *= sq;</span><br><span class="line">      b *= sq;</span><br><span class="line">      c *= sq;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> d = <span class="built_in">Math</span>.sin(angle),</span><br><span class="line">      e = <span class="built_in">Math</span>.cos(angle),</span><br><span class="line">      f = <span class="number">1</span> - e,</span><br><span class="line">      g = mat[<span class="number">0</span>],</span><br><span class="line">      h = mat[<span class="number">1</span>],</span><br><span class="line">      i = mat[<span class="number">2</span>],</span><br><span class="line">      j = mat[<span class="number">3</span>],</span><br><span class="line">      k = mat[<span class="number">4</span>],</span><br><span class="line">      l = mat[<span class="number">5</span>],</span><br><span class="line">      m = mat[<span class="number">6</span>],</span><br><span class="line">      n = mat[<span class="number">7</span>],</span><br><span class="line">      o = mat[<span class="number">8</span>],</span><br><span class="line">      p = mat[<span class="number">9</span>],</span><br><span class="line">      q = mat[<span class="number">10</span>],</span><br><span class="line">      r = mat[<span class="number">11</span>],</span><br><span class="line">      s = a * a * f + e,</span><br><span class="line">      t = b * a * f + c * d,</span><br><span class="line">      u = c * a * f - b * d,</span><br><span class="line">      v = a * b * f - c * d,</span><br><span class="line">      w = b * b * f + e,</span><br><span class="line">      x = c * b * f + a * d,</span><br><span class="line">      y = a * c * f + b * d,</span><br><span class="line">      z = b * c * f - a * d,</span><br><span class="line">      A = c * c * f + e;</span><br><span class="line">    <span class="keyword">if</span> (angle) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mat != dest) &#123;</span><br><span class="line">        dest[<span class="number">12</span>] = mat[<span class="number">12</span>];</span><br><span class="line">        dest[<span class="number">13</span>] = mat[<span class="number">13</span>];</span><br><span class="line">        dest[<span class="number">14</span>] = mat[<span class="number">14</span>];</span><br><span class="line">        dest[<span class="number">15</span>] = mat[<span class="number">15</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dest = mat;</span><br><span class="line">    &#125;</span><br><span class="line">    dest[<span class="number">0</span>] = g * s + k * t + o * u;</span><br><span class="line">    dest[<span class="number">1</span>] = h * s + l * t + p * u;</span><br><span class="line">    dest[<span class="number">2</span>] = i * s + m * t + q * u;</span><br><span class="line">    dest[<span class="number">3</span>] = j * s + n * t + r * u;</span><br><span class="line">    dest[<span class="number">4</span>] = g * v + k * w + o * x;</span><br><span class="line">    dest[<span class="number">5</span>] = h * v + l * w + p * x;</span><br><span class="line">    dest[<span class="number">6</span>] = i * v + m * w + q * x;</span><br><span class="line">    dest[<span class="number">7</span>] = j * v + n * w + r * x;</span><br><span class="line">    dest[<span class="number">8</span>] = g * y + k * z + o * A;</span><br><span class="line">    dest[<span class="number">9</span>] = h * y + l * z + p * A;</span><br><span class="line">    dest[<span class="number">10</span>] = i * y + m * z + q * A;</span><br><span class="line">    dest[<span class="number">11</span>] = j * y + n * z + r * A;</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.lookAt = <span class="function"><span class="keyword">function</span>(<span class="params">eye, center, up, dest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> eyeX = eye[<span class="number">0</span>],</span><br><span class="line">      eyeY = eye[<span class="number">1</span>],</span><br><span class="line">      eyeZ = eye[<span class="number">2</span>],</span><br><span class="line">      upX = up[<span class="number">0</span>],</span><br><span class="line">      upY = up[<span class="number">1</span>],</span><br><span class="line">      upZ = up[<span class="number">2</span>],</span><br><span class="line">      centerX = center[<span class="number">0</span>],</span><br><span class="line">      centerY = center[<span class="number">1</span>],</span><br><span class="line">      centerZ = center[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span> (eyeX == centerX &amp;&amp; eyeY == centerY &amp;&amp; eyeZ == centerZ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.identity(dest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> x0, x1, x2, y0, y1, y2, z0, z1, z2, l;</span><br><span class="line">    z0 = eyeX - center[<span class="number">0</span>];</span><br><span class="line">    z1 = eyeY - center[<span class="number">1</span>];</span><br><span class="line">    z2 = eyeZ - center[<span class="number">2</span>];</span><br><span class="line">    l = <span class="number">1</span> / <span class="built_in">Math</span>.sqrt(z0 * z0 + z1 * z1 + z2 * z2);</span><br><span class="line">    z0 *= l;</span><br><span class="line">    z1 *= l;</span><br><span class="line">    z2 *= l;</span><br><span class="line">    x0 = upY * z2 - upZ * z1;</span><br><span class="line">    x1 = upZ * z0 - upX * z2;</span><br><span class="line">    x2 = upX * z1 - upY * z0;</span><br><span class="line">    l = <span class="built_in">Math</span>.sqrt(x0 * x0 + x1 * x1 + x2 * x2);</span><br><span class="line">    <span class="keyword">if</span> (!l) &#123;</span><br><span class="line">      x0 = <span class="number">0</span>;</span><br><span class="line">      x1 = <span class="number">0</span>;</span><br><span class="line">      x2 = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      l = <span class="number">1</span> / l;</span><br><span class="line">      x0 *= l;</span><br><span class="line">      x1 *= l;</span><br><span class="line">      x2 *= l;</span><br><span class="line">    &#125;</span><br><span class="line">    y0 = z1 * x2 - z2 * x1;</span><br><span class="line">    y1 = z2 * x0 - z0 * x2;</span><br><span class="line">    y2 = z0 * x1 - z1 * x0;</span><br><span class="line">    l = <span class="built_in">Math</span>.sqrt(y0 * y0 + y1 * y1 + y2 * y2);</span><br><span class="line">    <span class="keyword">if</span> (!l) &#123;</span><br><span class="line">      y0 = <span class="number">0</span>;</span><br><span class="line">      y1 = <span class="number">0</span>;</span><br><span class="line">      y2 = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      l = <span class="number">1</span> / l;</span><br><span class="line">      y0 *= l;</span><br><span class="line">      y1 *= l;</span><br><span class="line">      y2 *= l;</span><br><span class="line">    &#125;</span><br><span class="line">    dest[<span class="number">0</span>] = x0;</span><br><span class="line">    dest[<span class="number">1</span>] = y0;</span><br><span class="line">    dest[<span class="number">2</span>] = z0;</span><br><span class="line">    dest[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">4</span>] = x1;</span><br><span class="line">    dest[<span class="number">5</span>] = y1;</span><br><span class="line">    dest[<span class="number">6</span>] = z1;</span><br><span class="line">    dest[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">8</span>] = x2;</span><br><span class="line">    dest[<span class="number">9</span>] = y2;</span><br><span class="line">    dest[<span class="number">10</span>] = z2;</span><br><span class="line">    dest[<span class="number">11</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">12</span>] = -(x0 * eyeX + x1 * eyeY + x2 * eyeZ);</span><br><span class="line">    dest[<span class="number">13</span>] = -(y0 * eyeX + y1 * eyeY + y2 * eyeZ);</span><br><span class="line">    dest[<span class="number">14</span>] = -(z0 * eyeX + z1 * eyeY + z2 * eyeZ);</span><br><span class="line">    dest[<span class="number">15</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.perspective = <span class="function"><span class="keyword">function</span>(<span class="params">fovy, aspect, near, far, dest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> t = near * <span class="built_in">Math</span>.tan((fovy * <span class="built_in">Math</span>.PI) / <span class="number">360</span>);</span><br><span class="line">    <span class="keyword">var</span> r = t * aspect;</span><br><span class="line">    <span class="keyword">var</span> a = r * <span class="number">2</span>,</span><br><span class="line">      b = t * <span class="number">2</span>,</span><br><span class="line">      c = far - near;</span><br><span class="line">    dest[<span class="number">0</span>] = (near * <span class="number">2</span>) / a;</span><br><span class="line">    dest[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">5</span>] = (near * <span class="number">2</span>) / b;</span><br><span class="line">    dest[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">9</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">10</span>] = -(far + near) / c;</span><br><span class="line">    dest[<span class="number">11</span>] = <span class="number">-1</span>;</span><br><span class="line">    dest[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">13</span>] = <span class="number">0</span>;</span><br><span class="line">    dest[<span class="number">14</span>] = -(far * near * <span class="number">2</span>) / c;</span><br><span class="line">    dest[<span class="number">15</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.transpose = <span class="function"><span class="keyword">function</span>(<span class="params">mat, dest</span>) </span>&#123;</span><br><span class="line">    dest[<span class="number">0</span>] = mat[<span class="number">0</span>];</span><br><span class="line">    dest[<span class="number">1</span>] = mat[<span class="number">4</span>];</span><br><span class="line">    dest[<span class="number">2</span>] = mat[<span class="number">8</span>];</span><br><span class="line">    dest[<span class="number">3</span>] = mat[<span class="number">12</span>];</span><br><span class="line">    dest[<span class="number">4</span>] = mat[<span class="number">1</span>];</span><br><span class="line">    dest[<span class="number">5</span>] = mat[<span class="number">5</span>];</span><br><span class="line">    dest[<span class="number">6</span>] = mat[<span class="number">9</span>];</span><br><span class="line">    dest[<span class="number">7</span>] = mat[<span class="number">13</span>];</span><br><span class="line">    dest[<span class="number">8</span>] = mat[<span class="number">2</span>];</span><br><span class="line">    dest[<span class="number">9</span>] = mat[<span class="number">6</span>];</span><br><span class="line">    dest[<span class="number">10</span>] = mat[<span class="number">10</span>];</span><br><span class="line">    dest[<span class="number">11</span>] = mat[<span class="number">14</span>];</span><br><span class="line">    dest[<span class="number">12</span>] = mat[<span class="number">3</span>];</span><br><span class="line">    dest[<span class="number">13</span>] = mat[<span class="number">7</span>];</span><br><span class="line">    dest[<span class="number">14</span>] = mat[<span class="number">11</span>];</span><br><span class="line">    dest[<span class="number">15</span>] = mat[<span class="number">15</span>];</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.inverse = <span class="function"><span class="keyword">function</span>(<span class="params">mat, dest</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = mat[<span class="number">0</span>],</span><br><span class="line">      b = mat[<span class="number">1</span>],</span><br><span class="line">      c = mat[<span class="number">2</span>],</span><br><span class="line">      d = mat[<span class="number">3</span>],</span><br><span class="line">      e = mat[<span class="number">4</span>],</span><br><span class="line">      f = mat[<span class="number">5</span>],</span><br><span class="line">      g = mat[<span class="number">6</span>],</span><br><span class="line">      h = mat[<span class="number">7</span>],</span><br><span class="line">      i = mat[<span class="number">8</span>],</span><br><span class="line">      j = mat[<span class="number">9</span>],</span><br><span class="line">      k = mat[<span class="number">10</span>],</span><br><span class="line">      l = mat[<span class="number">11</span>],</span><br><span class="line">      m = mat[<span class="number">12</span>],</span><br><span class="line">      n = mat[<span class="number">13</span>],</span><br><span class="line">      o = mat[<span class="number">14</span>],</span><br><span class="line">      p = mat[<span class="number">15</span>],</span><br><span class="line">      q = a * f - b * e,</span><br><span class="line">      r = a * g - c * e,</span><br><span class="line">      s = a * h - d * e,</span><br><span class="line">      t = b * g - c * f,</span><br><span class="line">      u = b * h - d * f,</span><br><span class="line">      v = c * h - d * g,</span><br><span class="line">      w = i * n - j * m,</span><br><span class="line">      x = i * o - k * m,</span><br><span class="line">      y = i * p - l * m,</span><br><span class="line">      z = j * o - k * n,</span><br><span class="line">      A = j * p - l * n,</span><br><span class="line">      B = k * p - l * o,</span><br><span class="line">      ivd = <span class="number">1</span> / (q * B - r * A + s * z + t * y - u * x + v * w);</span><br><span class="line">    dest[<span class="number">0</span>] = (f * B - g * A + h * z) * ivd;</span><br><span class="line">    dest[<span class="number">1</span>] = (-b * B + c * A - d * z) * ivd;</span><br><span class="line">    dest[<span class="number">2</span>] = (n * v - o * u + p * t) * ivd;</span><br><span class="line">    dest[<span class="number">3</span>] = (-j * v + k * u - l * t) * ivd;</span><br><span class="line">    dest[<span class="number">4</span>] = (-e * B + g * y - h * x) * ivd;</span><br><span class="line">    dest[<span class="number">5</span>] = (a * B - c * y + d * x) * ivd;</span><br><span class="line">    dest[<span class="number">6</span>] = (-m * v + o * s - p * r) * ivd;</span><br><span class="line">    dest[<span class="number">7</span>] = (i * v - k * s + l * r) * ivd;</span><br><span class="line">    dest[<span class="number">8</span>] = (e * A - f * y + h * w) * ivd;</span><br><span class="line">    dest[<span class="number">9</span>] = (-a * A + b * y - d * w) * ivd;</span><br><span class="line">    dest[<span class="number">10</span>] = (m * u - n * s + p * q) * ivd;</span><br><span class="line">    dest[<span class="number">11</span>] = (-i * u + j * s - l * q) * ivd;</span><br><span class="line">    dest[<span class="number">12</span>] = (-e * z + f * x - g * w) * ivd;</span><br><span class="line">    dest[<span class="number">13</span>] = (a * z - b * x + c * w) * ivd;</span><br><span class="line">    dest[<span class="number">14</span>] = (-m * t + n * r - o * q) * ivd;</span><br><span class="line">    dest[<span class="number">15</span>] = (i * t - j * r + k * q) * ivd;</span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码有注释就不展开讲了</p>
<h2 id="3-参考"><a href="#3-参考" class="headerlink" title="3 参考"></a>3 参考</h2><ul>
<li><a href="https://wgld.org/" target="_blank" rel="noopener">wgld.org</a>（<a href="https://blog.csdn.net/lufy_Legend/article/list/2?" target="_blank" rel="noopener">译文</a>）</li>
<li><a href="https://webglfundamentals.org/webgl/lessons/zh_cn/" target="_blank" rel="noopener">WebGL 理论基础</a></li>
<li><a href="https://github.com/QianMo/Game-Programmer-Study-Notes/blob/master/Content/%E3%80%8AReal-Time%20Rendering%203rd%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/README.md" target="_blank" rel="noopener">Real-Time Rendering 3rd</a></li>
<li><a href="http://www.opengl-tutorial.org/" target="_blank" rel="noopener">opengl-tutorial</a></li>
<li><a href="https://threejs.org/" target="_blank" rel="noopener">Three.js</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/04/Flow 漫谈/" rel="next" title="Flow 与 Typescript">
                <i class="fa fa-chevron-left"></i> Flow 与 Typescript
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/12/node-cli工具开发和原理/" rel="prev" title="Node CLI 工具开发和原理">
                Node CLI 工具开发和原理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="伍二娃" />
            
              <p class="site-author-name" itemprop="name">伍二娃</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/wave52" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/P9JlKs8JMvMso7U" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/wave52" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/wu-cheng-ran" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-学习了-WebGL-相当于学习了-OpenGL。"><span class="nav-number">1.</span> <span class="nav-text">1. 学习了 WebGL 相当于学习了 OpenGL。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-了解-GPU"><span class="nav-number">2.</span> <span class="nav-text">2. 了解 GPU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-入门图形学"><span class="nav-number">3.</span> <span class="nav-text">3. 入门图形学</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-大厂、大佬布道"><span class="nav-number">4.</span> <span class="nav-text">4. 大厂、大佬布道</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-图形学相关知识"><span class="nav-number"></span> <span class="nav-text">1 图形学相关知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-渲染管线"><span class="nav-number">1.</span> <span class="nav-text">1.1 渲染管线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）顶点着色器"><span class="nav-number">1.1.</span> <span class="nav-text">1）顶点着色器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）图元着色器"><span class="nav-number">1.2.</span> <span class="nav-text">2）图元着色器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3）裁剪"><span class="nav-number">1.3.</span> <span class="nav-text">3）裁剪</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4）屏幕映射"><span class="nav-number">1.4.</span> <span class="nav-text">4）屏幕映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5）三角形设定和遍历"><span class="nav-number">1.5.</span> <span class="nav-text">5）三角形设定和遍历</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6）像素着色器"><span class="nav-number">1.6.</span> <span class="nav-text">6）像素着色器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7）合并阶段"><span class="nav-number">1.7.</span> <span class="nav-text">7）合并阶段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-模型、视图、投影（MVP）"><span class="nav-number">2.</span> <span class="nav-text">1.2 模型、视图、投影（MVP）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-WebGL"><span class="nav-number"></span> <span class="nav-text">2 WebGL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-着色器"><span class="nav-number">1.</span> <span class="nav-text">2.1 着色器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-变换矩阵"><span class="nav-number">2.</span> <span class="nav-text">2.2 变换矩阵</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-缓存对象"><span class="nav-number">3.</span> <span class="nav-text">2.3 缓存对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-实践"><span class="nav-number">4.</span> <span class="nav-text">2.4 实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-参考"><span class="nav-number"></span> <span class="nav-text">3 参考</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">伍二娃</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
